## 도시를 세운다면?

- 각 분야를 관리하는 팀이 있기 때문에, 잘 돌아갈 수 있다.
    - 수도 관리 팀
    - 전력 관리 팀…
- 온갖 세세한 사항을 혼자서 직접 관리할 수 없다.
- 도시에는 **큰 그림을 그리는 사람**도 있으며 **작은 사항에 집중하는 
사람**도 있다.
    - 추상화 수준을 분리한다.
- 소프트웨어 팀도 도시처럼 구성한다.
    - 깨끗한 코드를 구현하면 낮은 추상화 수준에서 관심사를 분리하기 
쉬워진다.
    - 비슷한 수준으로 관심사를 분리하거나 추상화를 이뤄내지 못한다.
    - [ ]  낮은 추상화 수준? = 함수 단위
- 이번 장에서는 높은 추상화 수준 (시스템 수준) 에서도 깨끗함을 
유지하는 방법을 살펴본다.

## 시스템 제작과 시스템 사용을 분리하라

- 제작과 사용은 아주 다르다는 사실을 명심한다.

> 소프트웨어 시스템은 (애플리케이션 객체를 제작하고 의존성을 서로 
‘연결'하는) 준비 과정과 (준비 과정 이후에 이어지는) 런타임 로직을 
분리해야 한다.
> 

### 관심사 분리

- 시작 단계는 모든 애플리케이션이 풀어야할 관심사다.(?)
    - [시작 단계] 를 하나의 관심사로 보고 분리해야한다.
- 관심사 분리는 우리 분야에서 가장 오래되고 가장 중요한 설계 기법 중 
하나다.
- 대다수 애플리케이션은 시작 단계라는 관심사를 분리하지 않는다.
    - 준비 과정 코드를 런타임 로직과 마구 뒤섞는 문제
- 초기화 지연 기법에서 보이는 문제
    
    ```swift
    public Service getService() {
        if (service == null)
            service = new MyServiceImpl(...); // 모든 상황에 적합한 
기본 값일까?
        return service;
    }
    ```
    
    - 위 코드의 장점
        - 초기화 지연
            - 실제로 필요할 때까지 객체를 생성하지 않으므로 불필요한 
부하가 걸리지 않는다.
            - 어떤 경우에도 null 포인터를 반환하지 않는다. (Swift 
에서는 관련 없음)
    - 단점
        - getService 메서드가 MyServiceImpl 과 생성자 인수에 
명시적으로 의존한다.
        - 런타임 로직에서 MyServiceImpl 객체를 전혀 사용하지 않더라도 
의존성을 해결하지 않으면 컴파일이 안 된다.
        - 테스트도 문제다.
            - MyServiceImpl 이 무거운 객체라면 단위 테스트에서 
getService 메서드를 호출하기 전에 적절한 테스트 전용 객체 (Test 
Double 혹은 Mock Object) 를 service 필드에 할당해야한다.
            - 일반 런타임 로직에 객체 생성 로직을 섞어 놓았다.
                - 모든 실행 경로도 테스트해야한다.
                - 책임이 둘이다. (단일 책임 원칙을 깬다.)
- 설정 로직은 런타임 로직과 분리해야 모듈성이 높아진다.
- **또한 주요 의존성을 해소하기 위한 전반적이며 일관적인 방식도 
필요하다.**

### Main 분리

- 생성로직은 Main 에있다.
- 애플리케이션은 사용만 한다.

### 팩토리

- 생성시점을 애플리케이션이 갖게하고 싶을 때 팩토리를 사용한다.
- 주입

### 의존성 주입

- 제작과 사용을 분리하는 강력한 메커니즘 중 하나
    - 제어역전 기법을 의존성 관리에 적용한 메커니즘
- 의존성 주입을 사용하면서 초기화 지연의 장점을 가져가는 방법
    - 프록시나 팩토리를 사용한다.

## 확장

- 처음부터 올바르게 시스템을 만들 수 있다는 믿음은 미신이다.
- 애자일 방식의 핵심
    - 우리는 오늘 주어진 사용자 스토리에 맞춰 시스템을 구현해야한다.
    - 내일은 새로운 스토리에 맞춰 시스템을 조정하고 확장하면 된다.
- TDD, 리팩터링, 깨끗한 코드는 코드 수준에서 시스템을 조정하고 
확장하기 쉽게 만든다.

> 소프트 웨어 시스템은 현실의 시스템과 다르다. 관심사를 적절히 분리해 
관리한다면 소프트웨어 아키텍처는 점진적으로 발저할 수 있다.
> 

## 테스트 주도 시스템 아키텍처 구축

## 의사결정을 최적화하라

## 명백한 가치가 있을 때 표준을 현명하게 사용하라.

## 시스템은 도메인 특화 언어가 필요하다

## 결론
